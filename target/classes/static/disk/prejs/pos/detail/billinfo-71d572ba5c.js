define(["/js/common/initEcomm.js","/js/common/ajax.js"],function(e,t){function a(){e("finance_details"),n(),o(),i(),l()}function i(){var e=$(".wrap");e.on("click",".search-btn",c).on("change",".choose-shop",l).on("click",".download",d)}function o(){var e=$(".cur-shop").val(),t=$(".cur-bill-type").val();$(".choose-shop").attr("value",e),$(".choose-bill-type").attr("value",t)}function n(){r.datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii:ss",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0}).on("changeDate",function(e){s(r,$(".start-time-stamp")),p.datetimepicker("setStartDate",new Date($(".start-time-stamp").val()))}),p.datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii:ss",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0}).on("changeDate",function(e){s(p,$(".end-time-stamp")),r.datetimepicker("setEndDate",new Date($(".end-time-stamp").val()))});var e=new Date($(".default-start-date").val());r.datetimepicker("setDate",e);var t=new Date($(".default-end-date").val());p.datetimepicker("setDate",t),s(r,$(".start-time-stamp")),s(p,$(".end-time-stamp")),r.datetimepicker("setEndDate",new Date($(".end-time-stamp").val())),p.datetimepicker("setStartDate",new Date($(".start-time-stamp").val()))}function s(e,t){var a=e.val();t.val(a)}function c(){var e=$(".start-time-stamp").val(),t=$(".end-time-stamp").val(),a=$(".choose-shop").val(),i=$(".choose-bill-type").val(),o=$(".bill-num").val(),n=$(".choose-device").val();window.location.href="/payinfo/settleDetailList?shopId="+a+"&begin="+e+"&end="+t+"&payType="+i+"&tradeno="+o+"&deviceId="+n}function d(){var e=$(".start-time-stamp").val(),t=$(".end-time-stamp").val(),a=$(".choose-shop").val(),i=$(".choose-bill-type").val(),o=$(".bill-num").val(),n=$(".choose-device").val();window.location.href="/payinfo/exportSettleDetailExcel?shopId="+a+"&begin="+e+"&end="+t+"&payType="+i+"&tradeno="+o+"&deviceId="+n}function l(){var e=$(".choose-device"),a=$(".choose-shop").val(),i=$(".cur-deviceId").val(),o={poiId:a};t({type:"post",url:"/device/getDeviceListByPoiId",data:o}).done(function(t){var a=t;e.find("option").remove(),e.append("<option value='0'>全部</option>");for(var o=0;o<a.length;o++)e.append("<option value="+a[o].deviceId+">"+a[o].deviceSn+"</option>");e.attr("value",i)}).fail(function(e){alert("服务器故障，请稍候再试")})}var r=$("#start-date"),p=$("#end-date");return{init:a}});