define(["/js/common/initEcomm.js","/js/lib/juicer.js","/js/common/ajax.js","/js/common/page.js"],function(e,t,a,o){function i(){e("pos_details"),l(),s(),n(),v()}function n(){var e=$(".wrap");e.on("click",".search-btn",d).on("change",".choose-shop",v).on("click",".download",r)}function s(){var e=$(".cur-shop").val(),t=$(".cur-bill-type").val(),a=$(".cur-state").val();$(".choose-shop").attr("value",e),$(".choose-bill-type").attr("value",t),$(".choose-bill-state").attr("value",a)}function l(){p.datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii:ss",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0}).on("changeDate",function(e){c(p,$(".start-time-stamp")),m.datetimepicker("setStartDate",new Date($(".start-time-stamp").val()))}),m.datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii:ss",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,forceParse:0}).on("changeDate",function(e){c(m,$(".end-time-stamp")),p.datetimepicker("setEndDate",new Date($(".end-time-stamp").val()))});var e=new Date($(".default-start-date").val());p.datetimepicker("setDate",e);var t=new Date($(".default-end-date").val());m.datetimepicker("setDate",t),c(p,$(".start-time-stamp")),c(m,$(".end-time-stamp")),p.datetimepicker("setEndDate",new Date($(".end-time-stamp").val())),m.datetimepicker("setStartDate",new Date($(".start-time-stamp").val()))}function c(e,t){var a=e.val();t.val(a)}function d(){var e=$(".start-time-stamp").val(),t=$(".end-time-stamp").val(),a=$(".choose-shop").val(),o=$(".choose-bill-type").val(),i=$(".choose-bill-state").val(),n=$(".bill-num").val(),s=$(".choose-device").val();window.location.href="/order/list?shopId="+a+"&begin="+e+"&end="+t+"&payType="+o+"&tradeno="+n+"&status="+i+"&deviceId="+s}function r(){var e=$(".start-time-stamp").val(),t=$(".end-time-stamp").val(),a=$(".choose-shop").val(),o=$(".choose-bill-type").val(),i=$(".choose-bill-state").val(),n=$(".bill-num").val(),s=$(".choose-device").val();window.location.href="/order/exportRealTimeFlowExcel?shopId="+a+"&begin="+e+"&end="+t+"&payType="+o+"&tradeno="+n+"&status="+i+"&deviceId="+s}function v(){var e=$(".choose-device"),t=$(".choose-shop").val(),o=$(".cur-deviceId").val(),i={poiId:t};a({type:"post",url:"/device/getDeviceListByPoiId",data:i}).done(function(t){var a=t;e.find("option").remove(),e.append("<option value='0'>全部</option>");for(var i=0;i<a.length;i++)e.append("<option value="+a[i].deviceId+">"+a[i].deviceSn+"</option>");e.attr("value",o)}).fail(function(e){alert("服务器故障，请稍候再试")})}var p=$("#start-date"),m=$("#end-date");return{init:i}});